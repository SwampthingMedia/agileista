var update = function(data){
  var task_card = $('#task_card_' + data.task_id);
  var container = task_card.parent();
  updateTaskCard(container, task_card, data.task_hours, data.task_devs, data.performed_by, '<%= current_user.name %>');
  notifyUser(data, "<%= current_user.name %>");
  var us_card = $('div.user-story[data-story="' + data.user_story_id + '"]');
  us_card.attr('data-status', data.user_story_status);
  setupTaskBoardStats();
};

var source = new EventSource('http://localhost:9292/subscribe/<%= uid %>');

source.addEventListener('message', function (event) {
  var parsedData = JSON.parse(event.data);
  if (parsedData.refresh === 'true' && '<%=  escape_javascript current_user.name %>' !== parsedData.performed_by) {
    console.log ('yes');
  } else {
    update(parsedData);
  }
}, false);
