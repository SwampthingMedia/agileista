
<div id="main" class="wide">
<h1><%= sprint_header(@sprint) %></h1>
<%= @chart %>

<div id="tabs">
  <ul>
    <li><a href="#tabs-1">Summary</a></li>
    <li><a href="#tabs-2">Audit</a></li>
  </ul>
</div>

<div id="tabs-1">

<table id="current_sprint">
	<thead>
		<tr>
			<th></th><th>Title</th><th>Task hours</th><th>Story points</th><th>Assignee</th><th></th>
		</tr>
	</thead>
	<tbody>
		<% count = 0 -%>
		<% @sprint.sprint_elements.find(:all, :include => [:user_story], :order => 'sprint_elements.position').each do |element| %>
		<tr class="user_story">
			<% count += 1 -%>
			<td>#<%= count %></td>
			<td><%= truncate(element.user_story.definition, 50) %> <%= link_to "Show", sprint_user_story_path(:id => element.user_story, :sprint_id => @sprint), :title => element.user_story.definition if current_user.is_a?(TeamMember) %> <%= link_to "Copy", {:controller => 'user_stories', :action => 'copy', :id => element.user_story}, :method => :post, :title => "Copy" if current_user.is_a?(TeamMember) && !element.user_story.complete? %></td>
			<td><%= pluralize(element.user_story.tasks.count, "task") %></td>
			<td><%= show_story_points(element.user_story.story_points) %></td>
			<td><%= link_to_if current_user.is_a?(TeamMember), "Remove", {:controller => 'user_stories', :action => 'remove_from_sprint', :id => element.user_story, :sprint_id => @sprint}, :method => :post unless element.user_story.complete? %><%= "Complete" if element.user_story.complete? %></td>
			<td>User Story</td>
		</tr>
		<% element.user_story.tasks.each do |task| %>
		<tr class="task">
			<th scope="row">#<%= element.position.to_s + '.' + task.position.to_s %></th>
			<td class="title"><%= truncate(task.definition, 50) %> <%= link_to "Show", user_story_task_path(:id => task, :user_story_id => element.user_story) %></td>
			<td><%= show_hours_left(task.hours) %></td>
			<td></td>
			<td><%= show_assignee(task.developer) %></td>
			<td>Task</td>
		</tr>
		<% end %>
	  <% end %>
	</tbody>
</table>


</div>

<div id="tabs-2">
  
<table id="sprint_story_completeness">
  <thead>
    <tr>
      <th>User story</th><th>Complete?</th>
    </tr>
  </thead>
  <tbody>
    <%- for user_story in @sprint.user_stories -%>
    <tr>
      <td><%=h truncate(user_story.definition, 50) %></td>
      <td><%= user_story.complete? %></td>
    </tr>
    <%- end -%>
  </tbody>
</table>


<table id="sprint_changes">
  <thead>
    <tr>
      <th>Change</th>
      <th>Major?</th>
      <th>When</th>
      <th>Change</th>
      <th>By</th>
    </tr>
  </thead>
  <tbody>
    <%- for sprint_change in @sprint.audits -%>
    <tr>
      <td><%=h sprint_change.details %></td>
      <td><%= sprint_change.major? %></td>
      <td><%= show_date_and_time(sprint_change.created_at) %></td>
      <td><%- if sprint_change.kind == "update" %><%= ActiveSupport::JSON.decode(sprint_change.changes).inspect %><% end -%></td>
      <td><%= sprint_change.person ? sprint_change.person.name : "Unknown" %>
    </tr>
    <%- end -%>
  </tbody>
</table>

</div>

</div>

<script type="text/javascript" charset="utf-8">
  $(function() {
  		$("#tabs").tabs();
  	});
</script>
