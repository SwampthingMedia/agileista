var content = "<%= escape_javascript render :partial => 'sprints/task_card', :locals => {:sprint => @user_story.sprint, :user_story => @user_story, :task_card => @task } %>";
$(content).insertBefore($('#incomplete_<%= @user_story.id %> .new-task-card'));
var us_card = $('div.user-story[data-story=<%= @user_story.id %>]');
us_card.attr('data-status', '<%= @user_story.status %>');
setupTaskBoard(<%= @project.id %>, <%= @user_story.id %>);
setupTaskBoardStats();
$('input[name="task[definition]"]').val("");
$('.js-new-task-button').attr('disabled', true);

var spRemaining = <%= @chart_burnremaining.to_json.html_safe %>;
var spComplete = <%= @chart_burncomplete.to_json.html_safe %>;
var spHours = <%= @chart_burndown.to_json.html_safe %>;
var startDate = "<%= @sprint.start_at.to_date.iso8601.html_safe %>";
var endDate = "<%= 1.day.from_now(@sprint.end_at.to_date).iso8601.html_safe %>";
Agileista.drawBurndown(startDate, endDate, spRemaining, spComplete, spHours);
